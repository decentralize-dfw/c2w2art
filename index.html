<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dosya Yöneticisi Arayüzü</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Model Viewer (GLB dosyaları için) -->
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.5.0/model-viewer.min.js"></script>
    
    <style>
        /* Apple'ın "Inter" fontuna çok benzeyen ve Tailwind'in varsayılanı olan font ailesi */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            overflow: hidden; /* Sayfanın kaymasını engelle */
            background-color: #d1d5db; /* Arka planı hafif gri yapar (duvar kağıdı hissi için) */
        }

        /* Aktif olarak sürüklenen pencere */
        .dragging {
            user-select: none;
            cursor: grabbing !important;
            opacity: 0.8;
            transition: none !important; /* Sürüklerken gecikmeyi kaldır */
        }

        /* Yeniden boyutlandırılan pencere */
        .resizing {
            user-select: none;
            transition: none !important;
        }

        /* Seçili dosya stili */
        .file-item.selected > div {
            background-color: #eff6ff; /* bg-blue-50 */
            outline: 2px solid #3b82f6; /* border-blue-500 */
        }
        
        .file-item.selected > p {
            background-color: #3b82f6; /* bg-blue-600 */
            color: white;
            border-radius: 0.375rem;
        }

        /* List view selection */
        .list-view .file-item.selected {
            background-color: #3b82f6; /* bg-blue-600 */
        }
        .list-view .file-item.selected > p {
            color: white;
        }
        .list-view .file-item.selected .get-icon-svg {
             color: white !important; /* SVG ikonlarını beyaz yapar */
        }

        /* Pencere başlığındaki tuşlar */
        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(0,0,0,0.1);
        }
        .window-control.close { background-color: #fecaca; /* red-200 */ }
        .window-control.close:hover { background-color: #ef4444; /* red-500 */ }
        
        .window-control.minimize { background-color: #fef08a; /* yellow-200 */ }
        .window-control.minimize:hover { background-color: #eab308; /* yellow-500 */ }
        
        .window-control.maximize { background-color: #bbf7d0; /* green-200 */ }
        .window-control.maximize:hover { background-color: #22c55e; /* green-500 */ }
        
        .window-control .icon {
            visibility: hidden;
            width: 8px;
            height: 8px;
            color: rgba(0,0,0,0.5);
        }
        .window-control:hover .icon {
            visibility: visible;
        }

        /* Scrollbar stilleri (macOS benzeri) */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #a1a1aa; /* zinc-400 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #71717a; /* zinc-500 */
        }
        
        /* model-viewer için varsayılan stil */
        model-viewer {
            width: 100%;
            height: 100%;
            min-height: 400px; /* Min yükseklik */
        }
    </style>
</head>
<body class="bg-gray-200 p-8 flex items-center justify-center min-h-screen">

    <!-- Ana Finder Penceresi -->
    <div class="finder-window w-full max-w-6xl h-[80vh] bg-gray-50 rounded-xl shadow-2xl flex overflow-hidden border border-gray-300">

        <!-- Sol Sidebar -->
        <aside class="w-56 bg-gray-100/80 backdrop-blur-sm p-3 space-y-4 overflow-y-auto border-r border-gray-200 flex-shrink-0">
            <!-- Favoriler -->
            <div>
                <h3 class="text-xs font-semibold text-gray-500 px-2 mt-2 mb-1">Favorites</h3>
                <nav class="space-y-0.5">
                    <a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200">
                        <!-- SVG Icon: AirDrop -->
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        AirDrop
                    </a>
                    <a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200">
                        <!-- SVG Icon: Recents -->
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        Recents
                    </a>
                    <a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200">
                        <!-- SVG Icon: Applications -->
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.358A2.975 2.975 0 0119.022 16H4.978A2.975 2.975 0 013 13.358V11A2 2 0 015 9h14a2 2 0 012 2v2.358z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 9a2 2 0 11-4 0m4 0V6a2 2 0 00-2-2h-1.172a2 2 0 00-1.414.586L9 6M5 9a2 2 0 104 0M5 9V6a2 2 0 012-2h1.172a2 2 0 011.414.586L10 6"></path></svg>
                        Applications
                    </a>
                    <a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded-md text-sm font-medium text-gray-900 bg-gray-200" id="nav-desktop">
                        <!-- SVG Icon: Desktop -->
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                        Desktop
                    </a>
                    <a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200" id="nav-documents">
                        <!-- SVG Icon: Documents -->
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        Documents
                    </a>
                </nav>
            </div>
            <!-- iCloud -->
            <div>
                <h3 class="text-xs font-semibold text-gray-500 px-2 mt-4 mb-1">iCloud</h3>
                <nav class="space-y-0.5">
                    <a href="#" class="flex items-center gap-2 px-2 py-1.5 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-200">
                        <!-- SVG Icon: iCloud Drive -->
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-2.67-9.36A4 4 0 0012 3c-1.67 0-3.1 1-3.77 2.44A4 4 0 004 9v6h-1z"></path></svg>
                        iCloud Drive
                    </a>
                </nav>
            </div>
        </aside>

        <!-- Ana İçerik Alanı -->
        <main class="flex-1 flex flex-col bg-white overflow-hidden">
            
            <!-- Toolbar -->
            <header class="h-14 flex-shrink-0 flex items-center justify-between px-4 border-b border-gray-200">
                <!-- Sol Kontroller (Navigasyon) -->
                <div class="flex items-center gap-3">
                    <!-- Pencere Kontrolleri -->
                    <div class="flex items-center gap-1.5">
                        <div class="window-control close" id="main-close"></div>
                        <div class="window-control minimize" id="main-minimize"></div>
                        <div class="window-control maximize" id="main-maximize"></div>
                    </div>
                    
                    <button id="nav-back" class="p-1 rounded-md text-gray-400 hover:bg-gray-100 disabled:opacity-50" disabled>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="nav-forward" class="p-1 rounded-md text-gray-400 hover:bg-gray-100 disabled:opacity-50" disabled>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>

                <!-- Başlık -->
                <div class="flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <h2 class="text-sm font-semibold text-gray-800" id="current-folder-title">Desktop</h2>
                </div>

                <!-- Sağ Kontroller (Görünüm) -->
                <div class="flex items-center gap-3">
                    <div class="flex items-center bg-gray-100 rounded-md p-0.5 border border-gray-300">
                        <button id="view-grid" class="p-1.5 rounded text-gray-700 bg-white shadow-sm">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                        </button>
                        <button id="view-list" class="p-1.5 rounded text-gray-500 hover:bg-gray-200">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                        </button>
                        <button class="p-1.5 rounded text-gray-500 hover:bg-gray-200 disabled:opacity-50" disabled>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17V7m0 10a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2h2a2 2 0 012 2m0 10a2 2 0 002 2h2a2 2 0 002-2V7a2 2 0 00-2-2h-2a2 2 0 00-2 2"></path></svg>
                        </button>
                         <button class="p-1.5 rounded text-gray-500 hover:bg-gray-200 disabled:opacity-50" disabled>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8"></path></svg>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Dosya Tarayıcısı Alanı -->
            <div class="flex-1 flex overflow-hidden">
                <!-- Dosya Listesi -->
                <section class="flex-1 p-6 overflow-y-auto overflow-x-auto" id="file-browser-container">
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-x-4 gap-y-6 min-w-max" id="file-browser">
                        <!-- Dosyalar buraya JS ile eklenecek -->
                    </div>
                </section>

                <!-- Sağ Bilgi Paneli -->
                <aside class="w-80 bg-gray-50 border-l border-gray-200 p-4 overflow-y-auto hidden" id="info-panel">
                    <!-- Panel içeriği buraya JS ile eklenecek -->
                    <div class="flex flex-col items-center text-center" id="info-placeholder">
                        <svg class="w-24 h-24 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                        <p class="text-lg font-semibold text-gray-700 mt-2">Bilgi Al</p>
                        <p class="text-sm text-gray-500 mt-1">Bilgilerini görmek için bir öğe seçin.</p>
                    </div>
                    
                    <div id="info-content" class="hidden">
                        <!-- Önizleme ve Başlık -->
                        <div class="flex flex-col items-center text-center mb-4">
                            <div class="w-32 h-32 flex items-center justify-center mb-3" id="info-preview">
                                <!-- Önizleme (Resim, İkon vs.) -->
                            </div>
                            <h3 class="font-semibold text-gray-800" id="info-name"></h3>
                            <p class="text-sm text-gray-500" id="info-meta"></p>
                        </div>

                        <!-- Description -->
                        <div class="border-t border-gray-200 pt-4">
                            <h4 class="text-sm font-semibold text-gray-800 mb-2">Description</h4>
                            <p class="text-sm text-gray-600" id="info-description"></p>
                        </div>
                        
                        <!-- Bilgi Detayları -->
                        <div class="border-t border-gray-200 pt-4 mt-4">
                            <h4 class="text-sm font-semibold text-gray-800 mb-2">Details</h4>
                            <div class="space-y-1.5 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Created</span>
                                    <span class="font-medium text-gray-700" id="info-created"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Minted</span>
                                    <span class="font-medium text-gray-700" id="info-minted"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Medium</span>
                                    <span class="font-medium text-gray-700" id="info-medium"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Dimensions</span>
                                    <span class="font-medium text-gray-700" id="info-dimensions"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-500">Size</span>
                                    <span class="font-medium text-gray-700" id="info-size"></span>
                                </div>
                            </div>
                        </div>

                        <!-- Tags (Opsiyonel) -->
                        <div class="border-t border-gray-200 pt-4 mt-4" id="info-tags-section">
                             <h4 class="text-sm font-semibold text-gray-800 mb-2">Tags</h4>
                             <div class="flex flex-wrap gap-2" id="info-tags">
                                <!-- Tags will be dynamically inserted here -->
                             </div>
                        </div>
                    </div>
                </aside>
            </div>
        </main>
    </div>

    <!-- Pencerelerin oluşturulacağı alan -->
    <div id="window-container" class="absolute top-0 left-0 w-full h-full pointer-events-none">
        <!-- Açılan pencereler buraya JS ile eklenecek -->
    </div>

    <script>
        // --- ÖRNEK VERİ SİSTEMİ ---
        const fileSystemDB = {
            "Desktop": [
                {
                    id: 'f1-1',
                    type: 'folder',
                    name: 'Project Files',
                    folderKey: 'ProjectFiles', // Klasör ID'si
                    created: 'Monday, September 3, 2024 at 4:38 PM',
                    size: '1.2 GB'
                },
                {
                    id: 'f1-2',
                    type: 'image',
                    name: 'Bike_110279.jpg',
                    url: 'https://images.pexels.com/photos/597330/pexels-photo-597330.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
                    description: 'BMX bisikletli bir sporcunun duvarda yaptığı gösteri.',
                    created: 'Monday, September 3, 2024 at 4:38 PM',
                    minted: 'Monday, September 3, 2024 at 4:40 PM',
                    medium: 'Digital Photograph',
                    dimensions: '3024x4032',
                    size: '4 MB',
                    tags: ['bike', 'extreme', 'urban']
                },
                {
                    id: 'f1-3',
                    type: 'video',
                    name: 'Skate_Park_Clip.mp4',
                    url: 'https://videos.pexels.com/video-files/852400/852400-hd_1280_720_25fps.mp4',
                    description: 'Kaykay parkında bir gösteri.',
                    created: 'Friday, October 10, 2024 at 11:00 AM',
                    minted: 'Friday, October 10, 2024 at 11:01 AM',
                    medium: 'MP4 Video',
                    dimensions: '1920x1080',
                    size: '22 MB',
                    tags: ['skate', 'park', 'video']
                },
                 {
                    id: 'f1-4',
                    type: 'glb',
                    name: 'Astronaut.glb',
                    url: 'https://modelviewer.dev/shared-assets/models/Astronaut.glb',
                    description: 'Bir astronotun 3D modeli.',
                    created: 'Wednesday, June 5, 2024 at 09:30 AM',
                    minted: 'Wednesday, June 5, 2024 at 09:30 AM',
                    medium: 'GLB 3D Model',
                    dimensions: 'N/A',
                    size: '3.8 MB',
                    tags: ['3d', 'space', 'model']
                },
                {
                    id: 'f1-5',
                    type: 'text',
                    name: 'Proje Notları.txt',
                    content: 'Bu bir deneme metin dosyasıdır.\n\nArayüz geliştirme notları:\n- Pencere yönetimi tamamlanacak.\n- Bilgi paneli dinamik hale getirilecek.\n- Sürükle bırak özelliği eklenecek.',
                    description: 'Proje ile ilgili temel notlar.',
                    created: 'Today, 10:05 AM',
                    minted: 'Today, 10:05 AM',
                    medium: 'Text Document',
                    dimensions: 'N/A',
                    size: '1 KB',
                    tags: ['text', 'notes'],
                },
                {
                    id: 'f1-6',
                    type: 'html',
                    name: 'OrnekWebSayfasi.html',
                    url: 'https://raw.githubusercontent.com/decentralize-dfw/c2w2/main/offthechain.html', // Sizin verdiğiniz örnek URL
                    description: 'Örnek bir HTML sayfası.',
                    created: 'Today, 11:00 AM',
                    minted: 'Today, 11:00 AM',
                    medium: 'HTML Document',
                    dimensions: 'N/A',
                    size: '12 KB',
                    tags: ['web', 'html', 'example']
                }
            ],
            "ProjectFiles": [ // "Project Files" klasörünün içeriği
                 {
                    id: 'f2-1',
                    type: 'image',
                    name: 'Brentwood Hurricanes.png',
                    url: 'https://placehold.co/800x600/0033a0/white?text=Brentwood+Hurricanes+Triathlon',
                    description: 'Triatlon grafiği.',
                    created: 'Sunday, August 1, 2024 at 2:17 PM',
                    minted: 'Sunday, August 1, 2024 at 2:17 PM',
                    medium: 'PNG Image',
                    dimensions: '1200x800',
                    size: '1.1 MB',
                    tags: ['chart', 'sports', 'report']
                },
                {
                    id: 'f2-2',
                    type: 'image',
                    name: 'RoadTrip_024.jpg',
                    url: 'https://images.pexels.com/photos/1034662/pexels-photo-1034662.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
                    description: 'Gece şehir manzarası.',
                    created: 'Tuesday, July 20, 2024 at 8:55 PM',
                    minted: 'Tuesday, July 20, 2024 at 8:56 PM',
                    medium: 'Digital Photograph',
                    dimensions: '4000x3000',
                    size: '5.2 MB',
                    tags: ['city', 'night', 'travel']
                }
            ],
            "Documents": [
                // Şimdilik boş, buraya da dosya eklenebilir.
            ],
            "Applications": [
                // Şimdilik boş, buraya da dosya eklenebilir.
            ]

        };

        // --- GLOBAL STATE ---
        let currentFolder = 'Desktop';
        let selectedItemId = null;
        let openWindows = []; // { id, zIndex, element }
        let zIndexCounter = 10;
        let navHistory = ['Desktop']; // Navigasyon geçmişi
        let navIndex = 0; // Aktif geçmiş indeksi
        let currentViewMode = 'grid'; // 'grid' or 'list'
        
        // --- DOM ELEMENTLERİ ---
        const fileBrowser = document.getElementById('file-browser');
        const fileBrowserContainer = document.getElementById('file-browser-container');
        const infoPanel = document.getElementById('info-panel');
        const infoPlaceholder = document.getElementById('info-placeholder');
        const infoContent = document.getElementById('info-content');
        const windowContainer = document.getElementById('window-container');
        const currentFolderTitle = document.getElementById('current-folder-title');

        // --- FONKSİYONLAR ---

        /** Dosya/Klasörler için ikon oluşturan yardımcı fonksiyon */
        function getIcon(item) {
            switch(item.type) {
                case 'folder':
                    return `<svg class="w-full h-full text-blue-400 get-icon-svg" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"></path></svg>`;
                case 'image':
                    return `<img src="${item.url}" alt="${item.name}" class="w-full h-full object-cover rounded-md" onerror="this.src='https://placehold.co/100x100/e0e0e0/909090?text=Image';">`;
                case 'video':
                    return `<svg class="w-1/2 h-1/2 text-gray-500 get-icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M4 18h10a2 2 0 002-2V8a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>`;
                case 'glb':
                    return `<svg class="w-1/2 h-1/2 text-gray-500 get-icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m0 10l8 4m0 0v-4m0 0L4 11m8 4l8-4m-8 4v4m0 0L4 17m8 4l8-4"></path></svg>`;
                case 'text':
                    return `<svg class="w-1/2 h-1/2 text-gray-500 get-icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>`;
                case 'html':
                    return `<svg class="w-1/2 h-1/2 text-gray-500 get-icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m-8 4l-4 4 4 4m16-8l-4 4 4 4"></path></svg>`;
                default:
                    return `<svg class="w-1/2 h-1/2 text-gray-500 get-icon-svg" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>`;
            }
        }

        /** Yeni bir klasöre gider (geçmişi yönetir) */
        function navigateTo(folderName) {
            if (!fileSystemDB[folderName]) {
                console.warn(`Folder key "${folderName}" not found in fileSystemDB.`);
                folderName = 'Desktop'; // Hata durumunda Desktop'a dön
            }
            
            // Eğer yeni bir yere gidiyorsak (ileri/geri değil)
            if (folderName !== currentFolder && navHistory[navIndex] === currentFolder) {
                // İleri geçmişini temizle
                navHistory = navHistory.slice(0, navIndex + 1);
                // Yeni adresi ekle
                navHistory.push(folderName);
                navIndex++;
            }
            renderFileSystem(folderName);
        }
        
        /** Dosya tarayıcısını render eder */
        function renderFileSystem(folderName) {
            currentFolder = folderName;
            fileBrowser.innerHTML = '';
            const items = fileSystemDB[folderName] || [];
            
            // Başlığı güncelle
            currentFolderTitle.textContent = folderName;

            // Navigasyon tuşlarını güncelle
            document.getElementById('nav-back').disabled = (navIndex === 0);
            document.getElementById('nav-forward').disabled = (navIndex >= navHistory.length - 1);
            
            // Sidebar navigasyonunu güncelle
            document.querySelectorAll('aside nav a').forEach(a => a.classList.remove('bg-gray-200', 'text-gray-900'));
            const activeNav = document.getElementById(`nav-${folderName.toLowerCase()}`);
            if (activeNav) {
                activeNav.classList.add('bg-gray-200', 'text-gray-900');
            }

            // Görünüm moduna göre grid/list sınıflarını ayarla
            if (currentViewMode === 'grid') {
                fileBrowser.className = 'grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8 gap-x-4 gap-y-6 min-w-max';
            } else { // list view
                fileBrowser.className = 'flex flex-col min-w-max p-2 list-view'; // list-view sınıfı eklendi
            }
            
            if (items.length === 0) {
                fileBrowser.innerHTML = `<p class="text-gray-500 col-span-full text-center mt-10">This folder is empty.</p>`;
                return;
            }

            items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.dataset.id = item.id;
                
                if (currentViewMode === 'grid') {
                    itemEl.className = 'file-item flex flex-col items-center justify-start text-center cursor-pointer group';

                    const iconContainer = document.createElement('div');
                    iconContainer.className = 'w-24 h-24 p-2 flex items-center justify-center bg-gray-100 rounded-lg border border-gray-200 group-hover:shadow-md transition-shadow duration-150';
                    
                    if (item.type === 'image') {
                         iconContainer.innerHTML = getIcon(item);
                    } else if (item.type === 'folder') {
                        iconContainer.className = 'w-24 h-24 p-2 flex items-center justify-center rounded-lg transition-shadow duration-150'; // Klasör için arkaplan yok
                        iconContainer.innerHTML = getIcon(item);
                    } else {
                         iconContainer.innerHTML = getIcon(item);
                    }

                    const nameEl = document.createElement('p');
                    nameEl.className = 'text-xs font-medium text-gray-700 mt-2 break-all px-1 py-0.5';
                    nameEl.textContent = item.name;

                    itemEl.appendChild(iconContainer);
                    itemEl.appendChild(nameEl);
                } else { // List View
                    itemEl.className = 'file-item flex items-center gap-3 p-1.5 rounded-md cursor-pointer group';

                    const iconContainer = document.createElement('div');
                    iconContainer.className = 'w-6 h-6 flex-shrink-0 flex items-center justify-center';
                    
                    if (item.type === 'image') {
                         iconContainer.innerHTML = getIcon(item).replace('rounded-md', 'rounded-sm');
                    } else if (item.type === 'folder') {
                        iconContainer.innerHTML = getIcon(item);
                    } else {
                         iconContainer.className = 'w-6 h-6 flex-shrink-0 flex items-center justify-center bg-gray-100 rounded-sm';
                         iconContainer.innerHTML = getIcon(item).replace('w-1/2 h-1/2', 'w-4 h-4');
                    }

                    const nameEl = document.createElement('p');
                    nameEl.className = 'text-sm font-medium text-gray-800 truncate';
                    nameEl.textContent = item.name;
                    
                    // Liste görünümü için ekstra sütunlar
                    const dateEl = document.createElement('p');
                    dateEl.className = 'text-sm text-gray-500 ml-auto w-48 text-right flex-shrink-0';
                    dateEl.textContent = item.modified || '-';
                    
                    const sizeEl = document.createElement('p');
                    sizeEl.className = 'text-sm text-gray-500 w-24 text-right flex-shrink-0';
                    sizeEl.textContent = item.size || '-';

                    itemEl.appendChild(iconContainer);
                    itemEl.appendChild(nameEl);
                    itemEl.appendChild(dateEl);
                    itemEl.appendChild(sizeEl);
                }
                
                // --- Event Listeners ---
                let clickTimer = null;
                itemEl.addEventListener('click', (e) => {
                    if (clickTimer) {
                        // Çift Tıklama
                        clearTimeout(clickTimer);
                        clickTimer = null;
                        handleDoubleClick(item);
                    } else {
                        // Tek Tıklama
                        clickTimer = setTimeout(() => {
                            handleSingleClick(item);
                            clickTimer = null;
                        }, 250); // 250ms içinde ikinci tıklama gelmezse tek tık
                    }
                });
                
                fileBrowser.appendChild(itemEl);

            }); // forEach döngüsünü kapatır
            
        } // renderFileSystem fonksiyonunu kapatır

        /** Tek Tıklama: Öğeyi seç ve bilgileri göster */
        function handleSingleClick(item) {
            if (selectedItemId === item.id) {
                // Zaten seçiliyse, seçimi kaldır (toggle)
                deselectAll();
                hideInfoPanel();
            } else {
                // Yeni bir öğe seç
                deselectAll();
                selectedItemId = item.id;
                const itemEl = document.querySelector(`[data-id="${item.id}"]`);
                if (itemEl) {
                    itemEl.classList.add('selected');
                }
                showInfoPanel(item);
            }
        }

        /** Çift Tıklama: Pencere aç veya klasöre git */
        function handleDoubleClick(item) {
            if (item.type === 'folder') {
                if (item.folderKey) {
                    navigateTo(item.folderKey);
                } else {
                    console.warn(`Folder item "${item.name}" has no folderKey.`);
                    navigateTo(item.name); // Sadece boş klasörü göstermeyi dene
                }
            } else {
                openWindow(item);
            }
        }
        
        /** Tüm seçimleri kaldır */
        function deselectAll() {
            selectedItemId = null;
            document.querySelectorAll('.file-item.selected').forEach(el => {
                el.classList.remove('selected');
            });
        }
        
        /** Dışarıya tıklayınca seçimi kaldır */
        fileBrowserContainer.addEventListener('click', (e) => {
            if (e.target === fileBrowserContainer || e.target === fileBrowser) {
                deselectAll();
                hideInfoPanel();
            }
        });
        
        /** Bilgi panelini gizle */
        function hideInfoPanel() {
            infoPanel.classList.add('hidden');
            infoPlaceholder.classList.remove('hidden');
            infoContent.classList.add('hidden');
        }

        /** Bilgi panelini doldur ve göster */
        function showInfoPanel(item) {
            infoPanel.classList.remove('hidden');
            infoPlaceholder.classList.add('hidden');
            infoContent.classList.remove('hidden');

            // Önizleme
            const previewEl = document.getElementById('info-preview');
            if(item.type === 'image') {
                previewEl.innerHTML = `<img src="${item.url}" alt="preview" class="max-w-full max-h-full rounded-md object-contain" onerror="this.src='https://placehold.co/100x100/e0e0e0/909090?text=Image';">`;
            } else {
                previewEl.innerHTML = getIcon(item).replace('w-1/2 h-1/2', 'w-20 h-20').replace('w-full h-full', 'w-20 h-20');
            }
            
            // Bilgiler
            document.getElementById('info-name').textContent = item.name;
            document.getElementById('info-meta').textContent = `${item.type.charAt(0).toUpperCase() + item.type.slice(1)} - ${item.size || ''}`;
            
            // Yeni alanları doldur
            document.getElementById('info-description').textContent = item.description || '-';
            document.getElementById('info-created').textContent = item.created || '-';
            document.getElementById('info-minted').textContent = item.minted || '-';
            document.getElementById('info-medium').textContent = item.medium || '-';
            document.getElementById('info-dimensions').textContent = item.dimensions || '-';
            document.getElementById('info-size').textContent = item.size || '-';
            
            // Tags
            const tagsSection = document.getElementById('info-tags-section');
            const tagsContainer = document.getElementById('info-tags');
            tagsContainer.innerHTML = ''; // Öncekileri temizle

            if (item.tags && item.tags.length > 0) {
                item.tags.forEach(tag => {
                    const tagEl = document.createElement('span');
                    tagEl.className = 'text-xs font-medium bg-gray-200 text-gray-700 px-2 py-0.5 rounded-full';
                    tagEl.textContent = tag;
                    tagsContainer.appendChild(tagEl);
                });
                tagsSection.classList.remove('hidden');
            } else {
                tagsSection.classList.add('hidden');
            }
        }

        /** Yeni bir pencere açar */
        function openWindow(item) {
            zIndexCounter++;
            const windowId = `window-${item.id}-${Date.now()}`;
            
            const windowEl = document.createElement('div');
            windowEl.id = windowId;
            windowEl.className = 'floating-window absolute w-[600px] h-[400px] bg-white rounded-lg shadow-xl flex flex-col overflow-hidden border border-gray-300 pointer-events-auto';
            // Pencerelerin üst üste gelmesi için rastgele pozisyon
            const top = Math.floor(Math.random() * 100) + 50;
            const left = Math.floor(Math.random() * 200) + 100;
            windowEl.style.cssText = `top: ${top}px; left: ${left}px; z-index: ${zIndexCounter}; min-width: 300px; min-height: 200px;`;

            let contentHTML = '';
            let isAsyncContent = false; // HTML gibi asenkron yüklenecek içerik için bayrak

            switch(item.type) {
                case 'image':
                    contentHTML = `<img src="${item.url}" class="w-full h-full object-contain" alt="${item.name}">`;
                    break;
                case 'video':
                    contentHTML = `<video controls autoplay class="w-full h-full object-contain bg-black"><source src="${item.url}" type="video/mp4">Your browser does not support the video tag.</video>`;
                    break;
                case 'glb':
                    contentHTML = `<model-viewer src="${item.url}" alt="${item.description || item.name}" auto-rotate camera-controls ar shadow-intensity="1"></model-viewer>`;
                    break;
                case 'text':
                    contentHTML = `<pre class="w-full h-full p-4 font-mono text-sm overflow-auto whitespace-pre-wrap">${item.content}</pre>`;
                    break;
                case 'html':
                    contentHTML = `<iframe class="w-full h-full border-0" sandbox="allow-scripts allow-same-origin"></iframe>`; // Iframe'i boş oluştur
                    isAsyncContent = true;
                    break;
                default:
                    contentHTML = `<p class="p-4">Bu dosya türü için önizleme desteklenmiyor.</p>`;
            }

            windowEl.innerHTML = `
                <!-- Başlık Çubuğu -->
                <header class="window-header h-10 flex-shrink-0 bg-gray-100 flex items-center justify-between px-3 border-b border-gray-200 cursor-grab">
                    <div class="flex items-center gap-1.5">
                        <button class="window-control close" data-window-id="${windowId}">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                        <button class="window-control minimize" data-window-id="${windowId}">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M20 12H4"></path></svg>
                        </button>
                        <button class="window-control maximize" data-window-id="${windowId}">
                            <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M4 8V4h4m12 0h-4v4m0 8v4h-4m-8 0h4v-4"></path></svg>
                        </button>
                    </div>
                    <span class="text-sm font-medium text-gray-700">${item.name}</span>
                    <div class="w-16"></div> <!-- Boşluk -->
                </header>
                
                <!-- İçerik Alanı -->
                <div class="window-content flex-1 overflow-auto bg-gray-50">
                    ${contentHTML}
                </div>
                
                <!-- Yeniden Boyutlandırma Kolu -->
                <div class="resize-handle absolute bottom-0 right-0 w-4 h-4 cursor-se-resize" style="z-index: 1;"></div>
            `;
            
            windowContainer.appendChild(windowEl);
            openWindows.push({ id: windowId, element: windowEl, zIndex: zIndexCounter });
            
            // --- Asenkron İçerik Yükleyici (HTML Viewer için) ---
            if (isAsyncContent && item.type === 'html') {
                const iframe = windowEl.querySelector('iframe');
                if (item.url) {
                    fetch(item.url)
                        .then(response => {
                            if (!response.ok) throw new Error(`HTTP hatası! Durum: ${response.status}`);
                            return response.text();
                        })
                        .then(html => {
                            iframe.srcdoc = html; // Iframe'i güvenli srcdoc ile doldur
                        })
                        .catch(error => {
                            console.error('HTML Viewer Hatası:', error);
                            iframe.srcdoc = `<p class="p-4 text-red-500">İçerik yüklenirken hata oluştu: ${error.message}</p>`;
                        });
                } else if (item.content) {
                    iframe.srcdoc = item.content; // Eğer URL yerine doğrudan içerik varsa
                }
            }

            // Pencereye tıklayınca öne getir
            windowEl.addEventListener('mousedown', () => bringToFront(windowId), true);
            
            // Pencere kontrolleri
            windowEl.querySelector('.close').addEventListener('click', () => closeWindow(windowId));
            windowEl.querySelector('.maximize').addEventListener('click', () => maximizeWindow(windowId));
            
            // Sürükle ve Bırak
            makeDraggable(windowEl);
            // Yeniden Boyutlandırma
            makeResizable(windowEl);
        }

        /** Pencereyi kapatır */
        function closeWindow(windowId) {
            const windowEl = document.getElementById(windowId);
            if (windowEl) {
                windowEl.remove();
            }
            openWindows = openWindows.filter(w => w.id !== windowId);
        }

        /** Pencereyi öne getirir */
        function bringToFront(windowId) {
            const window = openWindows.find(w => w.id === windowId);
            if (window && window.zIndex < zIndexCounter) {
                zIndexCounter++;
                window.zIndex = zIndexCounter;
                window.element.style.zIndex = zIndexCounter;
            }
        }
        
        /** Pencereyi maximize/restore eder */
        function maximizeWindow(windowId) {
            const windowEl = document.getElementById(windowId);
            if (!windowEl) return;
            
            if (windowEl.classList.contains('fullscreen')) {
                // Restore
                windowEl.classList.remove('fullscreen');
                windowEl.style.top = windowEl.dataset.oldTop || '100px';
                windowEl.style.left = windowEl.dataset.oldLeft || '100px';
                windowEl.style.width = windowEl.dataset.oldWidth || '600px';
                windowEl.style.height = windowEl.dataset.oldHeight || '400px';
            } else {
                // Maximize
                // Mevcut durumu kaydet
                windowEl.dataset.oldTop = windowEl.style.top;
                windowEl.dataset.oldLeft = windowEl.style.left;
                windowEl.dataset.oldWidth = windowEl.style.width;
                windowEl.dataset.oldHeight = windowEl.style.height;
                
                windowEl.classList.add('fullscreen');
                windowEl.style.top = '0';
                windowEl.style.left = '0';
                windowEl.style.width = '100vw';
                windowEl.style.height = '100vh';
            }
        }

        /** Bir elementi sürüklenebilir yapar */
        function makeDraggable(element) {
            const header = element.querySelector('.window-header');
            if (!header) return;

            let offsetX, offsetY, isDragging = false;

            header.addEventListener('mousedown', (e) => {
                // Sadece header'a tıklandığında (tuşlara değil)
                if (e.target.closest('button')) return;
                
                isDragging = true;
                element.classList.add('dragging');
                bringToFront(element.id);

                offsetX = e.clientX - element.offsetLeft;
                offsetY = e.clientY - element.offsetTop;

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp, { once: true });
                
                e.preventDefault();
            });

            function onMouseMove(e) {
                if (!isDragging) return;
                
                let newX = e.clientX - offsetX;
                let newY = e.clientY - offsetY;
                
                // Sınırların dışına çıkmayı engelle (opsiyonel ama iyi olur)
                newX = Math.max(0, Math.min(newX, window.innerWidth - element.offsetWidth));
                newY = Math.max(0, Math.min(newY, window.innerHeight - element.offsetHeight));

                element.style.left = `${newX}px`;
                element.style.top = `${newY}px`;
            }

            function onMouseUp() {
                isDragging = false;
                element.classList.remove('dragging');
                document.removeEventListener('mousemove', onMouseMove);
            }
        }
        
        /** Bir elementi yeniden boyutlandırılabilir yapar */
        function makeResizable(element) {
            const resizeHandle = element.querySelector('.resize-handle');
            if (!resizeHandle) return;
            
            let startX, startY, startWidth, startHeight;
            let isResizing = false;

            resizeHandle.addEventListener('mousedown', (e) => {
                isResizing = true;
                element.classList.add('resizing');
                bringToFront(element.id);

                startX = e.clientX;
                startY = e.clientY;
                startWidth = parseInt(document.defaultView.getComputedStyle(element).width, 10);
                startHeight = parseInt(document.defaultView.getComputedStyle(element).height, 10);

                document.addEventListener('mousemove', onMouseMove);
                document.addEventListener('mouseup', onMouseUp, { once: true });
                
                e.preventDefault();
            });
            
            function onMouseMove(e) {
                if (!isResizing) return;
                
                const newWidth = startWidth + (e.clientX - startX);
                const newHeight = startHeight + (e.clientY - startY);
                
                element.style.width = `${newWidth}px`;
                element.style.height = `${newHeight}px`;
            }

            function onMouseUp() {
                isResizing = false;
                element.classList.remove('resizing');
                document.removeEventListener('mousemove', onMouseMove);
            }
        }
        
        // --- Başlangıç ---
        document.addEventListener('DOMContentLoaded', () => {
            // Başlangıçta ilk klasörü yükle
            navigateTo('Desktop');
            
            // Sol sidebar navigasyonu
            document.getElementById('nav-desktop').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('Desktop');
            });
            document.getElementById('nav-documents').addEventListener('click', (e) => {
                e.preventDefault();
                navigateTo('Documents');
            });

            // Geri/İleri Tuşları
            document.getElementById('nav-back').addEventListener('click', () => {
                if (navIndex > 0) {
                    navIndex--;
                    renderFileSystem(navHistory[navIndex]);
                }
            });
            document.getElementById('nav-forward').addEventListener('click', () => {
                if (navIndex < navHistory.length - 1) {
                    navIndex++;
                    renderFileSystem(navHistory[navIndex]);
                }
            });

            // Görünüm Modu Tuşları
            const viewGridBtn = document.getElementById('view-grid');
            const viewListBtn = document.getElementById('view-list');
            
            viewGridBtn.addEventListener('click', () => {
                if (currentViewMode === 'list') {
                    currentViewMode = 'grid';
                    viewGridBtn.classList.add('bg-white', 'shadow-sm', 'text-gray-700');
                    viewListBtn.classList.remove('bg-white', 'shadow-sm', 'text-gray-700');
                    renderFileSystem(currentFolder); // Arayüzü yeniden çiz
                }
            });
            
            viewListBtn.addEventListener('click', () => {
                if (currentViewMode === 'grid') {
                    currentViewMode = 'list';
                    viewListBtn.classList.add('bg-white', 'shadow-sm', 'text-gray-700');
                    viewGridBtn.classList.remove('bg-white', 'shadow-sm', 'text-gray-700');
                    renderFileSystem(currentFolder); // Arayüzü yeniden çiz
                }
            });
        });

    </script>
</body>
</html>





